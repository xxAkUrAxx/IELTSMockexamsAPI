<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Listening Test 1 - Section 2</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: white;
      margin: 0;
      padding: 0;
    }

    .timer {
      position: fixed;
      top: 10px;
      left: 10px;
      background: #1e90ff;
      color: white;
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 16px;
      z-index: 9;
    }

    .reset-timer-btn {
      position: fixed;
      top: 10px;
      left: 160px;
      z-index: 9;
      padding: 5px 10px;
      font-size: 14px;
    }

    .continue-button {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 15;
      background-color: #1e90ff;
      color: white;
      border: none;
      padding: 15px 25px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      display: none;
    }
    .centered-content {
    max-width: 800px;
    margin: 0 auto;
    }

    .message-box {
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      padding: 30px 40px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      border-radius: 10px;
      text-align: center;
      z-index: 15;
      display: none;
    }

    .message-box.show {
      display: block;
      animation: fadeIn 1s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .section {
      padding: 40px;
    }

    h1 {
      color: #1e90ff;
    }

    .instructions {
      font-size: 16px;
      margin-bottom: 20px;
    }

    input[type="text"] {
    width: 250px;
    padding: 6px;
    font-size: 14px;
    box-sizing: border-box;
    margin-top: 4px;
    text-align: center;
    display: inline-block;
    vertical-align: middle;
    }


    select {
    width: 250px;
    padding: 6px;
    font-size: 14px;
    box-sizing: border-box;
    margin-top: 4px;
    text-align: center;
    display: inline-block;
    vertical-align: middle;
    }


    .question-block {
      margin-bottom: 20px;
    }

    .dropdown-container {
      margin-top: 10px;
    }

    .info-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
    }

    #studentInfo {
      font-size: 14px;
      color: #333;
    }
  </style>
</head>
<body>

<div class="timer" id="timerDisplay">00:00 / 00:00</div>
<button class="continue-button" id="continueButton" onclick="resumeAudio()">▶ Continue Listening</button>

<div class="message-box" id="messageBox">Going to Section 3...</div>

<audio id="audio" preload="auto" src="Part2.mp3"></audio>

<div class="info-header">
  <div id="studentInfo"></div>
  <img src="narrow_logo.png" alt="Logo" style="height: 50px;" />
</div>

<div id="mainContent" class="section centered-content">
  <h1>PART 2</h1>
  <div class="instructions">
    <p><strong>Questions 11 – 17</strong></p>
    <p>Complete the sentences below. Write <strong>NO MORE THAN TWO WORDS</strong> for each answer.</p>
  </div>

  <div class="question-block">
    <p>11. To enjoy the day, make sure you <input type="text" id="q11" /> it first.</p>
    <p>12. Travel <input type="text" id="q12" /> within the city centre.</p>
    <p>13. Wear <input type="text" id="q13" /> on the day.</p>
    <p>14. Check the <input type="text" id="q14" /> the night before the marathon.</p>
    <p>15. Let the <input type="text" id="q15" /> give drinks to the runners.</p>
    <p>16. Stay on one side of the road to avoid <input type="text" id="q16" />.</p>
    <p>17. Don’t arrange to meet runners near the <input type="text" id="q17" />.</p>
  </div>

  <div class="instructions">
    <p><strong>Questions 18 – 20</strong></p>
    <p>What does the speaker say about the following forms of transport?</p>
    <p>Write the correct letter <strong>A, B, C, D or E</strong>, next to questions 18 – 20.</p>
  </div>

  <div style="margin-bottom: 20px;">
    <strong>A</strong> will take more passengers than usual<br />
    <strong>B</strong> will suit people who want to see the start of the race<br />
    <strong>C</strong> waiting times will be longer than usual<br />
    <strong>D</strong> will have fewer staff than usual<br />
    <strong>E</strong> some work schedules will change
  </div>

  <div class="question-block dropdown-container">
    <p>18. Taxis
      <select id="q18">
        <option value="">-- Select an answer --</option>
        <option value="A">A - more passengers than usual</option>
        <option value="B">B - suits people at race start</option>
        <option value="C">C - waiting times longer</option>
        <option value="D">D - fewer staff</option>
        <option value="E">E - work schedules will change</option>
      </select>
    </p>
    <p>19. Trams
      <select id="q19">
        <option value="">-- Select an answer --</option>
        <option value="A">A - more passengers than usual</option>
        <option value="B">B - suits people at race start</option>
        <option value="C">C - waiting times longer</option>
        <option value="D">D - fewer staff</option>
        <option value="E">E - work schedules will change</option>
      </select>
    </p>
    <p>20. Buses
      <select id="q20">
        <option value="">-- Select an answer --</option>
        <option value="A">A - more passengers than usual</option>
        <option value="B">B - suits people at race start</option>
        <option value="C">C - waiting times longer</option>
        <option value="D">D - fewer staff</option>
        <option value="E">E - work schedules will change</option>
      </select>
    </p>
  </div>

</div>

<script>
  const audio = document.getElementById("audio");
  const timerDisplay = document.getElementById("timerDisplay");
  const continueBtn = document.getElementById("continueButton");

  function formatTime(s) {
    const m = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return `${String(m).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
  }

  function startAudio() {
    const savedTime = parseFloat(localStorage.getItem("Listening2_AudioTime")) || 0;
    const resumeFrom = Math.max(0, savedTime - 2);
    if (savedTime > 0) {
      continueBtn.style.display = "block";
    } else {
      setTimeout(() => {
        audio.currentTime = 0;
        audio.play();
      }, 2000);
    }
  }

  function resumeAudio() {
    const savedTime = parseFloat(localStorage.getItem("Listening2_AudioTime")) || 0;
    const resumeFrom = Math.max(0, savedTime - 2);
    audio.currentTime = resumeFrom;
    audio.play();
    continueBtn.style.display = "none";
  }

  function resetTimer() {
    audio.pause();
    audio.currentTime = 0;
    localStorage.removeItem("Listening2_AudioTime");
    audio.play();
  }

  audio.onended = () => {
    document.getElementById("messageBox").classList.add("show");
    setTimeout(() => {
      window.location.href = "ListeningTest1Section3.html";
    }, 5000);
  };

  function displayStudentHeader() {
    const name = localStorage.getItem("studentFirstName") || "Name";
    const surname = localStorage.getItem("studentSurname") || "Surname";
    const nickname = localStorage.getItem("studentNickname") || "Nickname";
    const number = localStorage.getItem("studentNumber") || "ID";

    const infoBox = document.getElementById("studentInfo");
    infoBox.innerHTML = `
      <strong>${name} ${surname}</strong><br>
      Nickname: ${nickname}<br>
      Student Number: ${number}
    `;
  }

  window.onload = () => {
    displayStudentHeader();
    startAudio();

    for (let i = 11; i <= 20; i++) {
      const input = document.getElementById("q" + i);
      const saved = localStorage.getItem("Listening2_Q" + i);
      if (input && saved) input.value = saved;

      input?.addEventListener("input", () => {
        localStorage.setItem("Listening2_Q" + i, input.value.trim());
      });

      input?.addEventListener("change", () => {
        localStorage.setItem("Listening2_Q" + i, input.value.trim());
      });
    }

    setInterval(() => {
      localStorage.setItem("Listening2_AudioTime", audio.currentTime);
      timerDisplay.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration || 0)}`;
    }, 1000);
  };
// --- Anti-Cheat Logic (Tab/Window Focus Only) ---
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'hidden') {
    incrementCheatCounter();
  }
});

function incrementCheatCounter() {
  const current = parseInt(localStorage.getItem("Listening_CheatAttempts")) || 0;
  localStorage.setItem("Listening_CheatAttempts", current + 1);
}

window.addEventListener('blur', () => {
  recordCheatAttempt();
});
</script>

</body>
</html>
